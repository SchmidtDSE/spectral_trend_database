<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Biomass Yield and Spectral Trends - Spectral Trend Database</title><meta property="og:title" content="Biomass Yield and Spectral Trends - Spectral Trend Database"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/build/_assets/app-H3NBUYVS.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="/myst-theme.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><div class="p-1 mr-3"><img src="/build/dse-2.black-crop.sma-aae35a86983fe3794aa1ec088262adec.png" class="h-9 dark:hidden" alt="Spectral Trend Database" height="2.25rem"/><img src="/build/dse-2.white-crop.sma-f5e5be0d64876eb7d7bd3a300e18d3c9.png" class="hidden h-9 dark:block" alt="Spectral Trend Database" height="2.25rem"/></div><span class="text-md sm:text-xl tracking-tight sm:mr-5 sr-only">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3iop:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/SchmidtDSE/map_something" title="GitHub Repository: SchmidtDSE/map_something" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Biomass Yield and Spectral Trends</h1><header class="mt-4 not-prose"><div class="grid grid-cols-1 sm:grid-cols-2 gap-y-1"><div class="pb-2 text-xs font-thin uppercase">Authors</div><div class="pb-2 text-xs font-thin uppercase">Affiliations</div><div><span class="font-semibold text-sm"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R2mkfop:" data-state="closed">Brookie Guzder-Williams</button><a class="ml-1" href="mailto:bguzder-williams@berkeley.edu" title="Brookie Guzder-Williams &lt;bguzder-williams@berkeley.edu&gt;" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1rem" height="1rem" class="inline-block text-gray-400 hover:text-blue-400 -translate-y-[0.1em]"><path d="M21.8 18c0 1.1-.9 2-1.9 2H4.2c-1.1 0-1.9-.9-1.9-2V9.9c0-.5.3-.7.8-.4l7.8 4.7c.7.4 1.7.4 2.4 0L21 9.5c.4-.2.8-.1.8.4V18z"></path><path d="M21.8 6c0-1.1-.9-2-1.9-2H4.2c-1.1 0-2 .9-2 2v.4c0 .5.3 1.1.8 1.3l8.5 5.1c.2.1.7.1.9 0l8.6-5c.4-.3.8-.9.8-1.3-.1-.1-.1-.5 0-.5z"></path></svg></a><a class="ml-1" href="https://orcid.org/0000-0001-6855-8260" target="_blank" rel="noopener noreferrer" title="ORCID (Open Researcher and Contributor ID)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1rem" height="1rem" class="inline-block text-gray-400 hover:text-[#A9C751] -translate-y-[0.1em]"><path d="M21.8 12c0 5.4-4.4 9.8-9.8 9.8S2.2 17.4 2.2 12 6.6 2.2 12 2.2s9.8 4.4 9.8 9.8zM8.2 5.8c-.4 0-.8.3-.8.8s.3.8.8.8.8-.4.8-.8-.3-.8-.8-.8zm2.3 9.6h1.2v-6h1.8c2.3 0 3.3 1.4 3.3 3s-1.5 3-3.3 3h-3v1.1H9V8.3H7.7v8.2h5.9c3.3 0 4.5-2.2 4.5-4.1s-1.2-4.1-4.3-4.1h-3.2l-.1 7.1z"></path></svg></a></span></div><div class="text-sm"><div>The Eric and Wendy Schmidt Center for Data Science &amp; Environment<!-- --> </div><div>University of California, Berkeley<!-- --> </div></div><div><span class="font-semibold text-sm"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R2qkfop:" data-state="closed">Maya Weltman-Fahs</button></span></div><div class="text-sm"><div>The Eric and Wendy Schmidt Center for Data Science &amp; Environment<!-- --> </div><div>University of California, Berkeley<!-- --> </div></div></div></header></div><div id="skip-to-article"></div><div id="uS0vpsGaHH" class="relative group/block article-grid subgrid-gap col-screen"><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">date: 2024-12-12
authors:
    - name: Brookie Guzder-Williams
affiliations:
    - University of California Berkeley, The Eric and Wendy Schmidt Center for Data Science &amp; Environment
license: CC-BY-4.0</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div><div id="ZOB0w77uI0" class="relative group/block article-grid subgrid-gap col-screen"><p>This notebook uses DSE’s <a target="_blank" href="https://github.com/SchmidtDSE/spectral_trend_database" rel="noreferrer">Spectral Trend Database</a> (STDB) to
produce and interactive chart displaying Biomass Yield vs a number of different spectral incides over time.</p><ol start="1"><li>Fetch Data for a random point: We use STDS’s <a href="https://github.com/SchmidtDSE/spectral_trend_database/blob/main/spectral_trend_database/query.py" class="italic" target="_blank" rel="noreferrer" data-state="closed">query module</a> and in particular the <a href="https://github.com/SchmidtDSE/spectral_trend_database/blob/54146cf058e2180829e2c169b37c18ddf62b68a0/spectral_trend_database/query.py#L21-L114" class="italic" target="_blank" rel="noreferrer" data-state="closed"><code>QueryConstructor</code></a> to generate a ...</li><li>Build Chart</li><li>Save Chart JSON to improve responsiveness of chart</li></ol></div><div id="cGZk7sw1GP" class="relative group/block article-grid subgrid-gap col-screen"><hr class="py-2 my-5 translate-y-2"/><h2 id="imports" class="relative group"><span class="heading-text">IMPORTS</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#imports" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="nzBr01V26H" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from importlib import reload
from typing import Callable, Union, Optional, Literal, TypeAlias, Sequence, Any
import re
from pprint import pprint
import random
import pandas as pd
import numpy as np
import xarray as xr
import tensorflow as tf
from IPython.display import HTML
import matplotlib.pyplot as plt
import seaborn as sns
import altair as alt
from spectral_trend_database.config import config as c
from spectral_trend_database import query
from spectral_trend_database import utils
from sklearn.ensemble import RandomForestClassifier
from sklearn.ensemble import HistGradientBoostingClassifier
from sklearn import metrics</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="9Tvx-dQIJbfyU0nyYyxif" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="zE86jzADWR" class="relative group/block article-grid subgrid-gap col-screen"><hr class="py-2 my-5 translate-y-2"/><h2 id="config" class="relative group"><span class="heading-text">CONFIG</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#config" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="ebe3PczLSZ" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">BQ_PREFIX = &#x27;dse-regenag.BiomassTrends&#x27;
SAMPLE_FRAC = 0.0005
YEAR_START = 2008
YEAR_END = 2020
START_MMDD = &#x27;11-01&#x27;
END_MMDD = START_MMDD
ATTR_COLS = [
    &#x27;sample_id&#x27;,
    &#x27;lon&#x27;,
    &#x27;lat&#x27;]
LIST_ATTRS = [
    &#x27;year&#x27;,
    &#x27;biomass&#x27;,
    &#x27;crop_type&#x27;]
CHART_DATA_PATH = &#x27;spectral_trends.chart_data.json&#x27;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="NQ0vwwxkDkNiY9PeyKUBe" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="md89yE5Ojc" class="relative group/block article-grid subgrid-gap col-screen"><hr class="py-2 my-5 translate-y-2"/><h2 id="helper-methods" class="relative group"><span class="heading-text">HELPER METHODS</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#helper-methods" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="n95cFUcXqA" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def print_list(lst, max_len=7, view_size=3, sep=&#x27;, &#x27;, connector=&#x27; ... &#x27;):
    size = len(lst)
    if size &lt;= max_len:
        lst_str = sep.join(lst)
    else:
        head = sep.join(lst[:view_size])        
        tail = sep.join(lst[-view_size:])
        lst_str = f&#x27;{head}{connector}{tail}  [{size}]&#x27;
    print(lst_str)

def line(marker=&#x27;-&#x27;, length=100):
    print(marker*length)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Xqdfm3BadufyvT-H0lxL6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="l4B5jOQba4" class="relative group/block article-grid subgrid-gap col-screen"><hr class="py-2 my-5 translate-y-2"/><h2 id="stdb-database-info" class="relative group"><span class="heading-text">STDB DATABASE INFO</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#stdb-database-info" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>First we’ll take a quick peak at the what is in the STDB database</p></div><div id="HE5beNHuJS" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">YIELD_TABLE = &#x27;SCYM_YIELD&#x27;
SMOOTHED_INDICES_TABLE = &#x27;SMOOTHED_INDICES_V1&#x27;
IDENT_DATE_COLUMNS = [&#x27;sample_id&#x27;, &#x27;year&#x27;, &#x27;date&#x27;]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xtmEf32KxBqrSxIgfWdtf" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="XgU3DQfjsS" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">COLUMN_NAMES = {}
print(&#x27;DATABASE INFO&#x27;)
line()
query = reload(query)
table_names = query.table_names()
print(&#x27;TABLES:&#x27;)
pprint(table_names)
for table_name in [YIELD_TABLE, SMOOTHED_INDICES_TABLE]:
    COLUMN_NAMES[table_name] = query.column_names(table_name, run_query=True)
    print(f&#x27;\n{table_name}:&#x27;)
    print_list(COLUMN_NAMES[table_name])
line()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="jtIJJIBeogxn_8ZG3Tvr6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>DATABASE INFO
----------------------------------------------------------------------------------------------------
TABLES:
[&#x27;SMOOTHED_INDICES_V1&#x27;,
 &#x27;INDICES_STATS_V1&#x27;,
 &#x27;LANDSAT_RAW_MASKED&#x27;,
 &#x27;RAW_INDICES_V1&#x27;,
 &#x27;SAMPLE_POINTS&#x27;,
 &#x27;INDICES_STATS_V1_GROWING_SEASON&#x27;,
 &#x27;INDICES_STATS_V1_OFF_SEASON&#x27;,
 &#x27;ADMINISTRATIVE_BOUNDARIES&#x27;,
 &#x27;SCYM_YIELD&#x27;,
 &#x27;MACD_INDICES_V1&#x27;]

SCYM_YIELD:
biomass, crop_type, year, sample_id

SMOOTHED_INDICES_V1:
ndbr, ndvi, grvi ... sample_id, rdvi, year  [39]
----------------------------------------------------------------------------------------------------
</span></code></pre></div></div></div><div id="KGrDWRINrr" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">INDICES = [c for c in COLUMN_NAMES[SMOOTHED_INDICES_TABLE] if c not in IDENT_DATE_COLUMNS]
print_list(INDICES)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="e5NRL-s4bv7G5y_aPrM-r" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>ndbr, ndvi, grvi ... si, nli, rdvi  [36]
</span></code></pre></div></div></div><div id="SQU5fZRVNp" class="relative group/block article-grid subgrid-gap col-screen"><hr class="py-2 my-5 translate-y-2"/><h2 id="id-1-fetch-data" class="relative group"><span class="heading-text">1. Fetch Data</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-fetch-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="xDkq46KQ5H" class="relative group/block article-grid subgrid-gap col-screen"><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">a. select a small number of sample ids</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div><div id="pVgzE06rwr" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">qc = query.QueryConstructor(&#x27;SAMPLE_POINTS&#x27;, table_prefix=BQ_PREFIX)
qc.select(&#x27;sample_id&#x27;)
qc.append(f&#x27;WHERE RAND() &lt; {SAMPLE_FRAC}&#x27;)
sample_ids_df = query.run(sql=qc.sql(), print_sql=True)
sample_ids_df = sample_ids_df.drop_duplicates()
print(&#x27;nb_samples:&#x27;, sample_ids_df.shape[0])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="AwYq1ZNSSyuppVlEiru5P" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>[info] spectral_trend_database.query.run: SELECT sample_id FROM `dse-regenag.BiomassTrends.SAMPLE_POINTS` WHERE RAND() &lt; 0.0005
nb_samples: 10
</span></code></pre></div></div></div><div id="R3NXKZkPFN" class="relative group/block article-grid subgrid-gap col-screen"><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">b. fetch data for selected samples</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></div><div id="k7lHrlKb1m" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def fetch_yield_and_trend_data(
        year_start: int,
        year_end: Optional[int] = None,
        sample_id: Optional[Union[list[str], str]] = None,
        print_sql: Optional[bool] = False,
        limit: Optional[int] = None) -&gt; pd.DataFrame:
    &quot;&quot;&quot;
    Builds and Executes a SQL Query to get all data
    form a given set of sample_ids during a specified time 
    period.
    
    Args: 
        year_start (int): start year to select data
        year_end (Optional[int] = None): 
            last year to select data from (inclusive). if None use &lt;year_start&gt;
        sample_id (Optional[Union[list[str], str]] = None)
            sample_id or list of sample-ids of data to select. if none select 
            from all samples.
        print_sql (Optional[bool] = False)
        limit (Optional[int] = None)

    Returns:
        pd.DataFrame of smoothed-spectral-indices
    &quot;&quot;&quot;
    if year_end is None: 
        year_end=year_start
    qc = query.QueryConstructor(
        &#x27;SAMPLE_POINTS&#x27;, 
        table_prefix=BQ_PREFIX,
        using=[&#x27;sample_id&#x27;],  
        how=&#x27;inner&#x27;)
    qc.join(&#x27;SCYM_YIELD&#x27;)
    qc.join(&#x27;SMOOTHED_INDICES_V1&#x27;, &#x27;sample_id&#x27;, &#x27;year&#x27;)
    if sample_id:
        if isinstance(sample_id, list):
            sample_id = [f&quot;&#x27;{s}&#x27;&quot; for s in sample_id]
            sample_ids = f&#x27;({&quot;, &quot;.join(sample_id)})&#x27;
            qc.where(sample_id=sample_ids, sample_id_op=&#x27;in&#x27;)
        else:
            qc.where(sample_id=sample_id)
    qc.where(&#x27;SMOOTHED_INDICES_V1&#x27;, year=year_start, year_op=&#x27;&gt;=&#x27;)
    qc.where(&#x27;SMOOTHED_INDICES_V1&#x27;, year=year_end, year_op=&#x27;&lt;=&#x27;)
    df = query.run(sql=qc.sql(), print_sql=print_sql)
    return df</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="pPmP8_2gI15x38TOLZOxQ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="EqWw5Fsy40" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">data = fetch_yield_and_trend_data(
    year_start=YEAR_START,
    year_end=YEAR_END,
    sample_id=sample_ids_df.sample_id.tolist(),
    print_sql=True)

print(&#x27;shape:&#x27;, data.shape)
data.sample(3)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="NchStOW4xMIil1v4iSr4V" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="TQcTvsLp38" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">rows = data[data.sample_id == data.sample().sample_id.iloc[0]]
rows = rows.sort_values(&#x27;year&#x27;).reset_index(drop=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="MInXHx0pPbu5cpsXAmJOe" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="nEEQ17URIH" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">utils = reload(utils)
def filter_dates(row):
    return dict(date=slice(f&#x27;{row.year-1}-{START_MMDD}&#x27;, f&#x27;{row.year}-{END_MMDD}&#x27;))
    
ds = utils.rows_to_xr(
    rows, 
    coord=&#x27;date&#x27;, 
    sel=filter_dates, 
    attr_cols=ATTR_COLS,
    list_attrs=LIST_ATTRS)
ds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8YVVk-f1ZqTcmwRoIHUWj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="fWjWlyNw86" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">yield_biomass = { y: b for y,b in zip(ds.year, ds.biomass)}
crop_types = { y: b for y,b in zip(ds.year, ds.crop_type)}
dvars = { k: ds[k].data for k in ds.data_vars }
_df = pd.DataFrame(dvars)
_df[&#x27;date&#x27;] = ds.date.data
_df[&#x27;idx&#x27;] = list(_df.index)
_df[&#x27;year&#x27;] = _df.date.apply(lambda d: d.year)
_df[&#x27;biomass&#x27;] = _df.year.apply(lambda y: yield_biomass.get(y, None))
_df[&#x27;crop_type&#x27;] = _df.year.apply(lambda y: crop_types.get(y, &#x27;soy&#x27;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3jezlp6si03IjzrFizD6u" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="roCs9yDr5X" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">_df.date.astype(str)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-0u1D6yjMTnLINPw-iLhK" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="font-mono text-sm whitespace-pre-wrap"><code><span>0       2007-11-01
1       2007-11-02
2       2007-11-03
3       2007-11-04
4       2007-11-05
           ...    
4390    2019-10-28
4391    2019-10-29
4392    2019-10-30
4393    2019-10-31
4394    2019-11-01
Name: date, Length: 4395, dtype: object</span></code></div></div></div><div id="x1Lfem0UUQ" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># _df[&#x27;date&#x27;] = _df.date.astype(str).apply(lambda d: f&#x27;{d}T00:00:01.000Z&#x27;)
# _df[&#x27;date&#x27;] = pd.to_datetime(_df.date.astype(str))
# _df.to_json(CHART_DATA_PATH, orient=&#x27;records&#x27;, lines=False)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7Vkx_VQTLNLmZNU5cjwnU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="GCbGAjs3SJ" class="relative group/block article-grid subgrid-gap col-screen"><hr class="py-2 my-5 translate-y-2"/><h2 id="chart" class="relative group"><span class="heading-text">CHART</span><a class="no-underline text-inherit hover:text-inherit px-2 font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#chart" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="osvLRRg8Wr" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">S = 1.25
DEFAULT_INDEX = &#x27;ndvi&#x27;
HEIGHT = 400 * S
GRAPH_WIDTH = 600 * S
SI_COLOR = &#x27;#515e68&#x27;
SI_OPACITY = 0.6
YIELD_OPACITY = 0.5
TITLE_COLOR = &#x27;#333&#x27;
TITLE_SIZE = 22
TITLE_WEIGHT = 200
SUBTITLE_COLOR = &#x27;#aaa&#x27;
SUBTITLE_SIZE = 14
SOY_COLOR = &#x27;#4e9561&#x27;
CORN_COLOR = &#x27;#e2d644&#x27;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SjJqSF6gELxU4hDSil5FP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="YCYPmghHk5" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">TITLE = &#x27;SPECTRAL TRENDS&#x27;
SUBTITLE = &#x27;exploring yield as a function of spectral indices&#x27;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="UmEtt0Laj0VGLd9FniWdX" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="QN0rOebJKo" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">chart_data = _df
# chart_data = CHART_DATA_PATH</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="z_AlHELb7AcC2jGQ9Wjfs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="cRumik1CiN" class="relative group/block article-grid subgrid-gap col-screen"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div id="nb-indices-vs-yield-code" class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># alt.data_transformers.enable(&quot;vegafusion&quot;)

display(HTML(&quot;&quot;&quot;
&lt;style&gt;
  span.vega-bind-name {
    color: #555;
    margin: 0 10px 0 60px;
    font-size: 20px;
  }
  .vega-bind label select {
    color: #555;
    font-size: 18px;
  }
&lt;/style&gt;
&quot;&quot;&quot;))

# yield chart
yield_scale = alt.Scale(
    domain=[0.0, 3000],
    clamp=True
)
yield_color_scale = alt.Scale(
    domain=[&#x27;soy&#x27;, &#x27;corn&#x27;], 
    range=[SOY_COLOR, CORN_COLOR])
yield_yaxis = alt.Axis(title=&#x27;Biomass Yield&#x27;, titleFontSize=18, titleColor=TITLE_COLOR, titleFontWeight=TITLE_WEIGHT)
yield_chart = alt.Chart(chart_data).encode(
    x=alt.X(&#x27;date:T&#x27;, title=None),
    y=alt.Y(&#x27;biomass:Q&#x27;, axis=yield_yaxis, scale=yield_scale),
    color=alt.Color(&#x27;crop_type:N&#x27;, scale=yield_color_scale)
).mark_area(
    filled=True,
    opacity=YIELD_OPACITY,
    interpolate=&#x27;step-before&#x27;)

# interactive spectral index chart
si_yaxis = alt.Axis(title=&#x27;Spectral Index&#x27;, titleFontSize=18, titleColor=TITLE_COLOR, titleFontWeight=TITLE_WEIGHT)
si_dropdown = alt.binding_select(
    options=INDICES,
    labels=[n.upper() for n in INDICES],
    name=&#x27;Spectral Index: &#x27;.upper()
)
ycol_param = alt.param(
    value=DEFAULT_INDEX,
    bind=si_dropdown
)
si_chart = alt.Chart(chart_data).encode(
    x=alt.X(&#x27;date:T&#x27;, title=None),
    y=alt.Y(&#x27;y:Q&#x27;, axis=si_yaxis)
).properties(
    width=GRAPH_WIDTH,
    height=HEIGHT
).transform_calculate(
    y=f&#x27;datum[{ycol_param.name}]&#x27;
).add_params(
    ycol_param
).mark_area(
    fill=SI_COLOR,
    fillOpacity=SI_OPACITY
)

# display
title = alt.Title(
    TITLE,
    color=TITLE_COLOR,
    fontSize=TITLE_SIZE,
    fontWeight=TITLE_WEIGHT,
    subtitle=SUBTITLE,
    subtitleColor=SUBTITLE_COLOR,
    subtitleFontSize=SUBTITLE_SIZE)

chart = alt.layer(yield_chart, si_chart).resolve_scale(y=&#x27;independent&#x27;)
chart = chart.properties(
    title=title).configure_legend(
    title=None,
    labelFontSize=18,  
    labelColor=SUBTITLE_COLOR 
).interactive()
chart </code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div id="nb.indices_vs_yield-output" data-mdast-node-id="c3qPo_0dQGlcoxdBpfE7I" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/scripts"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">Spectral Trend Database</div>Scripts</div></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/build/_shared/chunk-JLDGA2DL.js"/><link rel="modulepreload" href="/build/_shared/chunk-YAIQ7LUU.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-ZQWAZXET.js"/><link rel="modulepreload" href="/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/build/_shared/chunk-IQBJE7PC.js"/><link rel="modulepreload" href="/build/_shared/chunk-5CFTM6YW.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-HROFNPGU.js"/><link rel="modulepreload" href="/build/_shared/chunk-N544LW6X.js"/><link rel="modulepreload" href="/build/routes/$-WNZNXUO2.js"/><script>window.__remixContext = {"url":"/spectral-trends","state":{"loaderData":{"root":{"config":{"title":"Spectral Trend Database","options":{"hide_toc":true,"hide_outline":true,"favicon":"/build/favicon-ab84509359dcde0991484e03627401de.ico","logo":"/build/dse-2.black-crop.sma-aae35a86983fe3794aa1ec088262adec.png","logo_dark":"/build/dse-2.white-crop.sma-f5e5be0d64876eb7d7bd3a300e18d3c9.png"},"myst":"1.3.18","nav":[],"actions":[],"projects":[{"title":"Spectral Trend Database","subtitle":"a historcal database spectral indices","authors":[{"nameParsed":{"literal":"Brookie Guzder-Williams","given":"Brookie","family":"Guzder-Williams"},"name":"Brookie Guzder-Williams","orcid":"0000-0001-6855-8260","corresponding":true,"email":"bguzder-williams@berkeley.edu","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Maya Weltman-Fahs","given":"Maya","family":"Weltman-Fahs"},"name":"Maya Weltman-Fahs","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/SchmidtDSE/map_something","affiliations":[{"id":"dse","name":"The Eric and Wendy Schmidt Center for Data Science \u0026 Environment"},{"id":"ucb","name":"University of California, Berkeley"}],"toc":[{"file":"myst/main.md"},{"file":"myst/sections/intro.md"},{"file":"myst/sections/data.md"},{"file":"myst/sections/scripts.md"},{"file":"nb/spectral_trends.ipynb"}],"exports":[],"bibliography":[],"index":"main","pages":[{"slug":"intro","title":"Description","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"data","title":"Sample Selection","description":"","date":"","thumbnail":"/build/cornsoy-reduction-ddfb3a725f5809f1fa89d64c75aa4fac.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"scripts","title":"Scripts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectral-trends","title":"Biomass Yield and Spectral Trends","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"CONTENT_CDN_PORT":"3101","MODE":"static"},"routes/$":{"config":{"title":"Spectral Trend Database","options":{"hide_toc":true,"hide_outline":true,"favicon":"/build/favicon-ab84509359dcde0991484e03627401de.ico","logo":"/build/dse-2.black-crop.sma-aae35a86983fe3794aa1ec088262adec.png","logo_dark":"/build/dse-2.white-crop.sma-f5e5be0d64876eb7d7bd3a300e18d3c9.png"},"myst":"1.3.18","nav":[],"actions":[],"projects":[{"title":"Spectral Trend Database","subtitle":"a historcal database spectral indices","authors":[{"nameParsed":{"literal":"Brookie Guzder-Williams","given":"Brookie","family":"Guzder-Williams"},"name":"Brookie Guzder-Williams","orcid":"0000-0001-6855-8260","corresponding":true,"email":"bguzder-williams@berkeley.edu","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Maya Weltman-Fahs","given":"Maya","family":"Weltman-Fahs"},"name":"Maya Weltman-Fahs","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/SchmidtDSE/map_something","affiliations":[{"id":"dse","name":"The Eric and Wendy Schmidt Center for Data Science \u0026 Environment"},{"id":"ucb","name":"University of California, Berkeley"}],"toc":[{"file":"myst/main.md"},{"file":"myst/sections/intro.md"},{"file":"myst/sections/data.md"},{"file":"myst/sections/scripts.md"},{"file":"nb/spectral_trends.ipynb"}],"exports":[],"bibliography":[],"index":"main","pages":[{"slug":"intro","title":"Description","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"data","title":"Sample Selection","description":"","date":"","thumbnail":"/build/cornsoy-reduction-ddfb3a725f5809f1fa89d64c75aa4fac.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"scripts","title":"Scripts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectral-trends","title":"Biomass Yield and Spectral Trends","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}]},"page":{"kind":"Notebook","sha256":"160e1d3b224d59a4f08eb0b3b474e64afbac40e71b807b6a042f0edcf9d6c0d4","slug":"spectral-trends","location":"/nb/spectral_trends.ipynb","dependencies":[],"frontmatter":{"title":"Biomass Yield and Spectral Trends","content_includes_title":false,"kernelspec":{"name":"stdb","display_name":"stdb","language":"python"},"authors":[{"nameParsed":{"literal":"Brookie Guzder-Williams","given":"Brookie","family":"Guzder-Williams"},"name":"Brookie Guzder-Williams","orcid":"0000-0001-6855-8260","corresponding":true,"email":"bguzder-williams@berkeley.edu","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Maya Weltman-Fahs","given":"Maya","family":"Weltman-Fahs"},"name":"Maya Weltman-Fahs","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/SchmidtDSE/map_something","affiliations":[{"id":"dse","name":"The Eric and Wendy Schmidt Center for Data Science \u0026 Environment"},{"id":"ucb","name":"University of California, Berkeley"}],"exports":[{"format":"ipynb","filename":"spectral_trends.ipynb","url":"/build/spectral_trends-df5f611174e42f88745f57076393c29c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"code","lang":"","value":"date: 2024-12-12\nauthors:\n    - name: Brookie Guzder-Williams\naffiliations:\n    - University of California Berkeley, The Eric and Wendy Schmidt Center for Data Science \u0026 Environment\nlicense: CC-BY-4.0","position":{"start":{"line":3,"column":1},"end":{"line":10,"column":1}},"key":"qgoeboxHHV"}],"key":"uS0vpsGaHH"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook uses DSE’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hT24RX4ZNi"},{"type":"link","url":"https://github.com/SchmidtDSE/spectral_trend_database","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Spectral Trend Database","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TFffmqMmIs"}],"urlSource":"https://github.com/SchmidtDSE/spectral_trend_database","error":true,"key":"glNlHrihk5"},{"type":"text","value":" (STDB) to\nproduce and interactive chart displaying Biomass Yield vs a number of different spectral incides over time.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SNRmwlBbwi"}],"key":"OT3RunIRb5"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Fetch Data for a random point: We use STDS’s ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VgssiZZgKF"},{"type":"link","url":"https://github.com/SchmidtDSE/spectral_trend_database/blob/main/spectral_trend_database/query.py","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"query module","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Y2FElpixrY"}],"urlSource":"https://github.com/SchmidtDSE/spectral_trend_database/blob/main/spectral_trend_database/query.py","data":{"kind":"file","org":"SchmidtDSE","repo":"spectral_trend_database","reference":"main","file":"spectral_trend_database/query.py","raw":"https://raw.githubusercontent.com/SchmidtDSE/spectral_trend_database/main/spectral_trend_database/query.py"},"internal":false,"protocol":"github","key":"yYZjMO4IyU"},{"type":"text","value":" and in particular the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ImIjd4AnhD"},{"type":"link","url":"https://github.com/SchmidtDSE/spectral_trend_database/blob/54146cf058e2180829e2c169b37c18ddf62b68a0/spectral_trend_database/query.py#L21-L114","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"inlineCode","value":"QueryConstructor","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ctPAlrFSkv"}],"urlSource":"https://github.com/SchmidtDSE/spectral_trend_database/blob/54146cf058e2180829e2c169b37c18ddf62b68a0/spectral_trend_database/query.py#L21-L114","data":{"kind":"file","org":"SchmidtDSE","repo":"spectral_trend_database","reference":"54146cf058e2180829e2c169b37c18ddf62b68a0","file":"spectral_trend_database/query.py","from":21,"to":114,"raw":"https://raw.githubusercontent.com/SchmidtDSE/spectral_trend_database/54146cf058e2180829e2c169b37c18ddf62b68a0/spectral_trend_database/query.py"},"internal":false,"protocol":"github","key":"A9NHT6H7lX"},{"type":"text","value":" to generate a ...","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ZXxzikMANq"}],"key":"DLnlDJgpDT"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Build Chart","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rkyrQXpcql"}],"key":"LDVOvIpx2h"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Save Chart JSON to improve responsiveness of chart","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"qmYOsL5VYe"}],"key":"PJDkNEso15"}],"key":"dFEw1oz81H"}],"key":"ZOB0w77uI0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wkkEpRF4SM"},{"type":"heading","depth":2,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"IMPORTS","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"rAbRsBiLUP"}],"identifier":"imports","label":"IMPORTS","html_id":"imports","implicit":true,"key":"pqnw2YZChz"}],"key":"cGZk7sw1GP"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"from importlib import reload\nfrom typing import Callable, Union, Optional, Literal, TypeAlias, Sequence, Any\nimport re\nfrom pprint import pprint\nimport random\nimport pandas as pd\nimport numpy as np\nimport xarray as xr\nimport tensorflow as tf\nfrom IPython.display import HTML\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport altair as alt\nfrom spectral_trend_database.config import config as c\nfrom spectral_trend_database import query\nfrom spectral_trend_database import utils\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import HistGradientBoostingClassifier\nfrom sklearn import metrics","key":"lgBczuCFv2"},{"type":"output","id":"9Tvx-dQIJbfyU0nyYyxif","data":[],"key":"gdFqplgCdF"}],"key":"nzBr01V26H"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QDT5pcD1y5"},{"type":"heading","depth":2,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"CONFIG","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"cD4xWapJ76"}],"identifier":"config","label":"CONFIG","html_id":"config","implicit":true,"key":"sCPPTqedaf"}],"key":"zE86jzADWR"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"BQ_PREFIX = 'dse-regenag.BiomassTrends'\nSAMPLE_FRAC = 0.0005\nYEAR_START = 2008\nYEAR_END = 2020\nSTART_MMDD = '11-01'\nEND_MMDD = START_MMDD\nATTR_COLS = [\n    'sample_id',\n    'lon',\n    'lat']\nLIST_ATTRS = [\n    'year',\n    'biomass',\n    'crop_type']\nCHART_DATA_PATH = 'spectral_trends.chart_data.json'","key":"zp4nKdzthw"},{"type":"output","id":"NQ0vwwxkDkNiY9PeyKUBe","data":[],"key":"xiLGItyjUf"}],"key":"ebe3PczLSZ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"UAHmbqzAmw"},{"type":"heading","depth":2,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"HELPER METHODS","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"p836cQfiJs"}],"identifier":"helper-methods","label":"HELPER METHODS","html_id":"helper-methods","implicit":true,"key":"ZoNkhzWszg"}],"key":"md89yE5Ojc"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"def print_list(lst, max_len=7, view_size=3, sep=', ', connector=' ... '):\n    size = len(lst)\n    if size \u003c= max_len:\n        lst_str = sep.join(lst)\n    else:\n        head = sep.join(lst[:view_size])        \n        tail = sep.join(lst[-view_size:])\n        lst_str = f'{head}{connector}{tail}  [{size}]'\n    print(lst_str)\n\ndef line(marker='-', length=100):\n    print(marker*length)","key":"AC79Gor9K3"},{"type":"output","id":"Xqdfm3BadufyvT-H0lxL6","data":[],"key":"S0aIrBWrsj"}],"key":"n95cFUcXqA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cC5vLkHS0d"},{"type":"heading","depth":2,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"STDB DATABASE INFO","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WlVmNaNfu0"}],"identifier":"stdb-database-info","label":"STDB DATABASE INFO","html_id":"stdb-database-info","implicit":true,"key":"lMZPDIO8iZ"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"First we’ll take a quick peak at the what is in the STDB database","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"kpvQjV3ljV"}],"key":"KZ3LE3eOOP"}],"key":"l4B5jOQba4"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"YIELD_TABLE = 'SCYM_YIELD'\nSMOOTHED_INDICES_TABLE = 'SMOOTHED_INDICES_V1'\nIDENT_DATE_COLUMNS = ['sample_id', 'year', 'date']","key":"MVFg1dXSzR"},{"type":"output","id":"xtmEf32KxBqrSxIgfWdtf","data":[],"key":"aat9h23L1p"}],"key":"HE5beNHuJS"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"COLUMN_NAMES = {}\nprint('DATABASE INFO')\nline()\nquery = reload(query)\ntable_names = query.table_names()\nprint('TABLES:')\npprint(table_names)\nfor table_name in [YIELD_TABLE, SMOOTHED_INDICES_TABLE]:\n    COLUMN_NAMES[table_name] = query.column_names(table_name, run_query=True)\n    print(f'\\n{table_name}:')\n    print_list(COLUMN_NAMES[table_name])\nline()","key":"mEiiGfzaz1"},{"type":"output","id":"jtIJJIBeogxn_8ZG3Tvr6","data":[{"name":"stdout","output_type":"stream","text":"DATABASE INFO\n----------------------------------------------------------------------------------------------------\nTABLES:\n['SMOOTHED_INDICES_V1',\n 'INDICES_STATS_V1',\n 'LANDSAT_RAW_MASKED',\n 'RAW_INDICES_V1',\n 'SAMPLE_POINTS',\n 'INDICES_STATS_V1_GROWING_SEASON',\n 'INDICES_STATS_V1_OFF_SEASON',\n 'ADMINISTRATIVE_BOUNDARIES',\n 'SCYM_YIELD',\n 'MACD_INDICES_V1']\n\nSCYM_YIELD:\nbiomass, crop_type, year, sample_id\n\nSMOOTHED_INDICES_V1:\nndbr, ndvi, grvi ... sample_id, rdvi, year  [39]\n----------------------------------------------------------------------------------------------------\n"}],"key":"t91cq8Obk1"}],"key":"XgU3DQfjsS"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"INDICES = [c for c in COLUMN_NAMES[SMOOTHED_INDICES_TABLE] if c not in IDENT_DATE_COLUMNS]\nprint_list(INDICES)","key":"zuiIihMtW5"},{"type":"output","id":"e5NRL-s4bv7G5y_aPrM-r","data":[{"name":"stdout","output_type":"stream","text":"ndbr, ndvi, grvi ... si, nli, rdvi  [36]\n"}],"key":"t2rFLkIIJT"}],"key":"KGrDWRINrr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qlrRoL39L0"},{"type":"heading","depth":2,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"1. Fetch Data","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DeXDpN4So5"}],"identifier":"id-1-fetch-data","label":"1. Fetch Data","html_id":"id-1-fetch-data","implicit":true,"key":"Gu48AnSKih"}],"key":"SQU5fZRVNp"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"code","lang":"","value":"a. select a small number of sample ids","key":"WHQLNxc9cl"}],"key":"xDkq46KQ5H"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"qc = query.QueryConstructor('SAMPLE_POINTS', table_prefix=BQ_PREFIX)\nqc.select('sample_id')\nqc.append(f'WHERE RAND() \u003c {SAMPLE_FRAC}')\nsample_ids_df = query.run(sql=qc.sql(), print_sql=True)\nsample_ids_df = sample_ids_df.drop_duplicates()\nprint('nb_samples:', sample_ids_df.shape[0])","key":"w30Rrblec5"},{"type":"output","id":"AwYq1ZNSSyuppVlEiru5P","data":[{"name":"stdout","output_type":"stream","text":"[info] spectral_trend_database.query.run: SELECT sample_id FROM `dse-regenag.BiomassTrends.SAMPLE_POINTS` WHERE RAND() \u003c 0.0005\nnb_samples: 10\n"}],"key":"clb98yGFF4"}],"key":"pVgzE06rwr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"code","lang":"","value":"b. fetch data for selected samples","key":"aTP3LfFn7P"}],"key":"R3NXKZkPFN"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"def fetch_yield_and_trend_data(\n        year_start: int,\n        year_end: Optional[int] = None,\n        sample_id: Optional[Union[list[str], str]] = None,\n        print_sql: Optional[bool] = False,\n        limit: Optional[int] = None) -\u003e pd.DataFrame:\n    \"\"\"\n    Builds and Executes a SQL Query to get all data\n    form a given set of sample_ids during a specified time \n    period.\n    \n    Args: \n        year_start (int): start year to select data\n        year_end (Optional[int] = None): \n            last year to select data from (inclusive). if None use \u003cyear_start\u003e\n        sample_id (Optional[Union[list[str], str]] = None)\n            sample_id or list of sample-ids of data to select. if none select \n            from all samples.\n        print_sql (Optional[bool] = False)\n        limit (Optional[int] = None)\n\n    Returns:\n        pd.DataFrame of smoothed-spectral-indices\n    \"\"\"\n    if year_end is None: \n        year_end=year_start\n    qc = query.QueryConstructor(\n        'SAMPLE_POINTS', \n        table_prefix=BQ_PREFIX,\n        using=['sample_id'],  \n        how='inner')\n    qc.join('SCYM_YIELD')\n    qc.join('SMOOTHED_INDICES_V1', 'sample_id', 'year')\n    if sample_id:\n        if isinstance(sample_id, list):\n            sample_id = [f\"'{s}'\" for s in sample_id]\n            sample_ids = f'({\", \".join(sample_id)})'\n            qc.where(sample_id=sample_ids, sample_id_op='in')\n        else:\n            qc.where(sample_id=sample_id)\n    qc.where('SMOOTHED_INDICES_V1', year=year_start, year_op='\u003e=')\n    qc.where('SMOOTHED_INDICES_V1', year=year_end, year_op='\u003c=')\n    df = query.run(sql=qc.sql(), print_sql=print_sql)\n    return df","key":"LPd9FLmwcK"},{"type":"output","id":"pPmP8_2gI15x38TOLZOxQ","data":[],"key":"DGWisEL9Ng"}],"key":"k7lHrlKb1m"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"data = fetch_yield_and_trend_data(\n    year_start=YEAR_START,\n    year_end=YEAR_END,\n    sample_id=sample_ids_df.sample_id.tolist(),\n    print_sql=True)\n\nprint('shape:', data.shape)\ndata.sample(3)","key":"Z2H5eivmpZ"},{"type":"output","id":"NchStOW4xMIil1v4iSr4V","data":[{"name":"stdout","output_type":"stream","text":"[info] spectral_trend_database.query.run: SELECT * FROM `dse-regenag.BiomassTrends.SAMPLE_POINTS` INNER JOIN `dse-regenag.BiomassTrends.SCYM_YIELD` USING (sample_id) INNER JOIN `dse-regenag.BiomassTrends.SMOOTHED_INDICES_V1` USING (sample_id, year) WHERE `dse-regenag.BiomassTrends.SAMPLE_POINTS`.sample_id in ('9zg4c1qgqku', '9zmhp42txzr', '9zs4bx6nhpk', '9zv00u7vv7r', 'cbhb01bbyjy', 'dp0e5zwyq3r', 'dp0rw10qucn', 'dp1hxcshs9g', 'dp1z8bd5vje', 'dp2t1cqfz0z') AND `dse-regenag.BiomassTrends.SMOOTHED_INDICES_V1`.year \u003e= 2008 AND `dse-regenag.BiomassTrends.SMOOTHED_INDICES_V1`.year \u003c= 2020\nshape: (122, 46)\n"},{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/html":{"content":"\u003cdiv\u003e\n\u003cstyle scoped\u003e\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n\u003c/style\u003e\n\u003ctable border=\"1\" class=\"dataframe\"\u003e\n  \u003cthead\u003e\n    \u003ctr style=\"text-align: right;\"\u003e\n      \u003cth\u003e\u003c/th\u003e\n      \u003cth\u003esample_id\u003c/th\u003e\n      \u003cth\u003eyear\u003c/th\u003e\n      \u003cth\u003egeohash_5\u003c/th\u003e\n      \u003cth\u003egeohash_7\u003c/th\u003e\n      \u003cth\u003egeohash_9\u003c/th\u003e\n      \u003cth\u003elon\u003c/th\u003e\n      \u003cth\u003elat\u003c/th\u003e\n      \u003cth\u003ebiomass\u003c/th\u003e\n      \u003cth\u003ecrop_type\u003c/th\u003e\n      \u003cth\u003endbr\u003c/th\u003e\n      \u003cth\u003e...\u003c/th\u003e\n      \u003cth\u003emsr\u003c/th\u003e\n      \u003cth\u003etvi\u003c/th\u003e\n      \u003cth\u003esi1\u003c/th\u003e\n      \u003cth\u003ervi\u003c/th\u003e\n      \u003cth\u003etdvi\u003c/th\u003e\n      \u003cth\u003eosavi\u003c/th\u003e\n      \u003cth\u003esi\u003c/th\u003e\n      \u003cth\u003enli\u003c/th\u003e\n      \u003cth\u003edate\u003c/th\u003e\n      \u003cth\u003erdvi\u003c/th\u003e\n    \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n    \u003ctr\u003e\n      \u003cth\u003e17\u003c/th\u003e\n      \u003ctd\u003e9zmhp42txzr\u003c/td\u003e\n      \u003ctd\u003e2010\u003c/td\u003e\n      \u003ctd\u003e9zmhp\u003c/td\u003e\n      \u003ctd\u003e9zmhp42\u003c/td\u003e\n      \u003ctd\u003e9zmhp42tx\u003c/td\u003e\n      \u003ctd\u003e-93.910104\u003c/td\u003e\n      \u003ctd\u003e41.497719\u003c/td\u003e\n      \u003ctd\u003e2338\u003c/td\u003e\n      \u003ctd\u003ecorn\u003c/td\u003e\n      \u003ctd\u003e[0.8020385168710418, 0.761111421352999, 0.7212...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e[2.833344026642882, 2.605392583520121, 2.39049...\u003c/td\u003e\n      \u003ctd\u003e[1.18813572972331, 1.1612336370067855, 1.13585...\u003c/td\u003e\n      \u003ctd\u003e[0.04697344634080947, 0.05942996108841286, 0.0...\u003c/td\u003e\n      \u003ctd\u003e[14.497812856094473, 13.271434815748242, 12.11...\u003c/td\u003e\n      \u003ctd\u003e[0.7922603813634755, 0.7408201033375185, 0.692...\u003c/td\u003e\n      \u003ctd\u003e[0.6888106469336722, 0.6450891646813475, 0.603...\u003c/td\u003e\n      \u003ctd\u003e[0.030679068250658387, 0.043937479459377066, 0...\u003c/td\u003e\n      \u003ctd\u003e[0.8447933525916264, 0.7432393664406607, 0.646...\u003c/td\u003e\n      \u003ctd\u003e[2009-09-05T00:00:00.000000000, 2009-09-06T00:...\u003c/td\u003e\n      \u003ctd\u003e[0.6436694696741146, 0.6028117506307256, 0.564...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e97\u003c/th\u003e\n      \u003ctd\u003edp1hxcshs9g\u003c/td\u003e\n      \u003ctd\u003e2019\u003c/td\u003e\n      \u003ctd\u003edp1hx\u003c/td\u003e\n      \u003ctd\u003edp1hxcs\u003c/td\u003e\n      \u003ctd\u003edp1hxcshs\u003c/td\u003e\n      \u003ctd\u003e-88.247483\u003c/td\u003e\n      \u003ctd\u003e40.175038\u003c/td\u003e\n      \u003ctd\u003e933\u003c/td\u003e\n      \u003ctd\u003esoy\u003c/td\u003e\n      \u003ctd\u003e[0.5416618662580623, 0.49794495603168176, 0.45...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e[1.3396010438805517, 1.2521736265218133, 1.168...\u003c/td\u003e\n      \u003ctd\u003e[1.09283545107797, 1.0758940770811551, 1.05953...\u003c/td\u003e\n      \u003ctd\u003e[0.06444315995137456, 0.06569119617075751, 0.0...\u003c/td\u003e\n      \u003ctd\u003e[5.3692832472491885, 5.032731062206502, 4.7142...\u003c/td\u003e\n      \u003ctd\u003e[0.3878954289539703, 0.36588399604133715, 0.34...\u003c/td\u003e\n      \u003ctd\u003e[0.4413680815141847, 0.41771976878131545, 0.39...\u003c/td\u003e\n      \u003ctd\u003e[0.04954502843579181, 0.05067451694958326, 0.0...\u003c/td\u003e\n      \u003ctd\u003e[0.12229554748168381, 0.05837311643034407, -0....\u003c/td\u003e\n      \u003ctd\u003e[2018-09-02T00:00:00.000000000, 2018-09-03T00:...\u003c/td\u003e\n      \u003ctd\u003e[0.37198273396544956, 0.3521462789494104, 0.33...\u003c/td\u003e\n    \u003c/tr\u003e\n    \u003ctr\u003e\n      \u003cth\u003e38\u003c/th\u003e\n      \u003ctd\u003e9zv00u7vv7r\u003c/td\u003e\n      \u003ctd\u003e2008\u003c/td\u003e\n      \u003ctd\u003e9zv00\u003c/td\u003e\n      \u003ctd\u003e9zv00u7\u003c/td\u003e\n      \u003ctd\u003e9zv00u7vv\u003c/td\u003e\n      \u003ctd\u003e-94.180406\u003c/td\u003e\n      \u003ctd\u003e43.618102\u003c/td\u003e\n      \u003ctd\u003e2638\u003c/td\u003e\n      \u003ctd\u003ecorn\u003c/td\u003e\n      \u003ctd\u003e[0.21655032309999994, 0.21167971548749995, 0.2...\u003c/td\u003e\n      \u003ctd\u003e...\u003c/td\u003e\n      \u003ctd\u003e[0.6532791573999996, 0.6442685212749997, 0.635...\u003c/td\u003e\n      \u003ctd\u003e[0.9930999128428565, 0.9894172873374995, 0.985...\u003c/td\u003e\n      \u003ctd\u003e[0.0935228940142857, 0.0927293686375, 0.091935...\u003c/td\u003e\n      \u003ctd\u003e[2.6917618916999997, 2.6678134904624997, 2.643...\u003c/td\u003e\n      \u003ctd\u003e[0.2954465449000001, 0.2910558050625001, 0.286...\u003c/td\u003e\n      \u003ctd\u003e[0.3245218118714285, 0.31988473388749994, 0.31...\u003c/td\u003e\n      \u003ctd\u003e[0.07004421972857144, 0.06961416357500001, 0.0...\u003c/td\u003e\n      \u003ctd\u003e[-0.17554894249999992, -0.1866578000499999, -0...\u003c/td\u003e\n      \u003ctd\u003e[2007-09-08T00:00:00.000000000, 2007-09-09T00:...\u003c/td\u003e\n      \u003ctd\u003e[0.27629586752857144, 0.27233666763750003, 0.2...\u003c/td\u003e\n    \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e3 rows × 46 columns\u003c/p\u003e\n\u003c/div\u003e","content_type":"text/html"},"text/plain":{"content":"      sample_id  year geohash_5 geohash_7  geohash_9        lon        lat  \\\n17  9zmhp42txzr  2010     9zmhp   9zmhp42  9zmhp42tx -93.910104  41.497719   \n97  dp1hxcshs9g  2019     dp1hx   dp1hxcs  dp1hxcshs -88.247483  40.175038   \n38  9zv00u7vv7r  2008     9zv00   9zv00u7  9zv00u7vv -94.180406  43.618102   \n\n    biomass crop_type                                               ndbr  ...  \\\n17     2338      corn  [0.8020385168710418, 0.761111421352999, 0.7212...  ...   \n97      933       soy  [0.5416618662580623, 0.49794495603168176, 0.45...  ...   \n38     2638      corn  [0.21655032309999994, 0.21167971548749995, 0.2...  ...   \n\n                                                  msr  \\\n17  [2.833344026642882, 2.605392583520121, 2.39049...   \n97  [1.3396010438805517, 1.2521736265218133, 1.168...   \n38  [0.6532791573999996, 0.6442685212749997, 0.635...   \n\n                                                  tvi  \\\n17  [1.18813572972331, 1.1612336370067855, 1.13585...   \n97  [1.09283545107797, 1.0758940770811551, 1.05953...   \n38  [0.9930999128428565, 0.9894172873374995, 0.985...   \n\n                                                  si1  \\\n17  [0.04697344634080947, 0.05942996108841286, 0.0...   \n97  [0.06444315995137456, 0.06569119617075751, 0.0...   \n38  [0.0935228940142857, 0.0927293686375, 0.091935...   \n\n                                                  rvi  \\\n17  [14.497812856094473, 13.271434815748242, 12.11...   \n97  [5.3692832472491885, 5.032731062206502, 4.7142...   \n38  [2.6917618916999997, 2.6678134904624997, 2.643...   \n\n                                                 tdvi  \\\n17  [0.7922603813634755, 0.7408201033375185, 0.692...   \n97  [0.3878954289539703, 0.36588399604133715, 0.34...   \n38  [0.2954465449000001, 0.2910558050625001, 0.286...   \n\n                                                osavi  \\\n17  [0.6888106469336722, 0.6450891646813475, 0.603...   \n97  [0.4413680815141847, 0.41771976878131545, 0.39...   \n38  [0.3245218118714285, 0.31988473388749994, 0.31...   \n\n                                                   si  \\\n17  [0.030679068250658387, 0.043937479459377066, 0...   \n97  [0.04954502843579181, 0.05067451694958326, 0.0...   \n38  [0.07004421972857144, 0.06961416357500001, 0.0...   \n\n                                                  nli  \\\n17  [0.8447933525916264, 0.7432393664406607, 0.646...   \n97  [0.12229554748168381, 0.05837311643034407, -0....   \n38  [-0.17554894249999992, -0.1866578000499999, -0...   \n\n                                                 date  \\\n17  [2009-09-05T00:00:00.000000000, 2009-09-06T00:...   \n97  [2018-09-02T00:00:00.000000000, 2018-09-03T00:...   \n38  [2007-09-08T00:00:00.000000000, 2007-09-09T00:...   \n\n                                                 rdvi  \n17  [0.6436694696741146, 0.6028117506307256, 0.564...  \n97  [0.37198273396544956, 0.3521462789494104, 0.33...  \n38  [0.27629586752857144, 0.27233666763750003, 0.2...  \n\n[3 rows x 46 columns]","content_type":"text/plain"}}}],"key":"HO5o0yTZII"}],"key":"EqWw5Fsy40"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"rows = data[data.sample_id == data.sample().sample_id.iloc[0]]\nrows = rows.sort_values('year').reset_index(drop=True)","key":"p9HhbHtOvC"},{"type":"output","id":"MInXHx0pPbu5cpsXAmJOe","data":[],"key":"zXz0fTamLM"}],"key":"TQcTvsLp38"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"utils = reload(utils)\ndef filter_dates(row):\n    return dict(date=slice(f'{row.year-1}-{START_MMDD}', f'{row.year}-{END_MMDD}'))\n    \nds = utils.rows_to_xr(\n    rows, \n    coord='date', \n    sel=filter_dates, \n    attr_cols=ATTR_COLS,\n    list_attrs=LIST_ATTRS)\nds","key":"wBmTsPoJie"},{"type":"output","id":"8YVVk-f1ZqTcmwRoIHUWj","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"ecab4244e5dc89fe7e1e8154f33fbe68","path":"/build/ecab4244e5dc89fe7e1e8154f33fbe68.html"},"text/plain":{"content":"\u003cxarray.Dataset\u003e\nDimensions:   (date: 4395)\nCoordinates:\n  * date      (date) datetime64[ns] 2007-11-01 2007-11-02 ... 2019-11-01\nData variables: (12/36)\n    ndbr      (date) float64 -0.1972 -0.196 -0.1941 ... 0.2481 0.2495 0.2509\n    ndvi      (date) float64 0.1673 0.1652 0.1629 ... 0.2764 0.2667 0.2566\n    grvi      (date) float64 1.702 1.684 1.665 1.645 ... 2.451 2.385 2.32 2.255\n    ndwi      (date) float64 -0.2543 -0.2484 -0.2422 ... -0.4093 -0.3979 -0.3858\n    slavi     (date) float64 0.4503 0.4501 0.4501 ... 0.7933 0.7765 0.7619\n    ndmi      (date) float64 -0.2768 -0.2731 -0.2688 ... 0.008362 0.01423\n    ...        ...\n    rvi       (date) float64 1.409 1.404 1.399 1.393 ... 1.642 1.565 1.496 1.434\n    tdvi      (date) float64 0.08235 0.08073 0.07905 ... 0.1372 0.1305 0.1241\n    osavi     (date) float64 0.1015 0.09983 0.09806 ... 0.1672 0.1602 0.1532\n    si        (date) float64 0.1032 0.1061 0.1094 0.113 ... 0.1254 0.1344 0.1441\n    nli       (date) float64 -0.6237 -0.6243 -0.6246 ... -0.5074 -0.5128 -0.5168\n    rdvi      (date) float64 0.0849 0.08348 0.08198 ... 0.1402 0.1343 0.1283\nAttributes:\n    sample_id:  cbhb01bbyjy\n    lon:        -94.5690164606\n    lat:        45.0097736326\n    year:       [2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, ...\n    biomass:    [669, 2844, 811, 2704, 693, 2268, 648, 3176, 836, 3459, 790, ...\n    crop_type:  ['soy', 'corn', 'soy', 'corn', 'soy', 'corn', 'soy', 'corn', ...","content_type":"text/plain"}}}],"key":"OCF6A4TFKo"}],"key":"nEEQ17URIH"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"yield_biomass = { y: b for y,b in zip(ds.year, ds.biomass)}\ncrop_types = { y: b for y,b in zip(ds.year, ds.crop_type)}\ndvars = { k: ds[k].data for k in ds.data_vars }\n_df = pd.DataFrame(dvars)\n_df['date'] = ds.date.data\n_df['idx'] = list(_df.index)\n_df['year'] = _df.date.apply(lambda d: d.year)\n_df['biomass'] = _df.year.apply(lambda y: yield_biomass.get(y, None))\n_df['crop_type'] = _df.year.apply(lambda y: crop_types.get(y, 'soy'))","key":"mmdtGr4FeE"},{"type":"output","id":"3jezlp6si03IjzrFizD6u","data":[],"key":"e6cchFU8hh"}],"key":"fWjWlyNw86"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"_df.date.astype(str)","key":"yg1SUFJ4Xa"},{"type":"output","id":"-0u1D6yjMTnLINPw-iLhK","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"0       2007-11-01\n1       2007-11-02\n2       2007-11-03\n3       2007-11-04\n4       2007-11-05\n           ...    \n4390    2019-10-28\n4391    2019-10-29\n4392    2019-10-30\n4393    2019-10-31\n4394    2019-11-01\nName: date, Length: 4395, dtype: object","content_type":"text/plain"}}}],"key":"aqaaJvJiE0"}],"key":"roCs9yDr5X"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# _df['date'] = _df.date.astype(str).apply(lambda d: f'{d}T00:00:01.000Z')\n# _df['date'] = pd.to_datetime(_df.date.astype(str))\n# _df.to_json(CHART_DATA_PATH, orient='records', lines=False)","key":"E1kgp8NRYc"},{"type":"output","id":"7Vkx_VQTLNLmZNU5cjwnU","data":[],"key":"VwhZH5Szdc"}],"key":"x1Lfem0UUQ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"thematicBreak","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kr8zWExUME"},{"type":"heading","depth":2,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"CHART","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RyFpFLRA1Z"}],"identifier":"chart","label":"CHART","html_id":"chart","implicit":true,"key":"hHBpDSwfmW"}],"key":"GCbGAjs3SJ"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"S = 1.25\nDEFAULT_INDEX = 'ndvi'\nHEIGHT = 400 * S\nGRAPH_WIDTH = 600 * S\nSI_COLOR = '#515e68'\nSI_OPACITY = 0.6\nYIELD_OPACITY = 0.5\nTITLE_COLOR = '#333'\nTITLE_SIZE = 22\nTITLE_WEIGHT = 200\nSUBTITLE_COLOR = '#aaa'\nSUBTITLE_SIZE = 14\nSOY_COLOR = '#4e9561'\nCORN_COLOR = '#e2d644'","key":"bM32S1DSJz"},{"type":"output","id":"SjJqSF6gELxU4hDSil5FP","data":[],"key":"gS1dt68eav"}],"key":"osvLRRg8Wr"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"TITLE = 'SPECTRAL TRENDS'\nSUBTITLE = 'exploring yield as a function of spectral indices'","key":"gZCTw6jraY"},{"type":"output","id":"UmEtt0Laj0VGLd9FniWdX","data":[],"key":"XBpYzLxmXA"}],"key":"YCYPmghHk5"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"chart_data = _df\n# chart_data = CHART_DATA_PATH","key":"nQNELqSxFs"},{"type":"output","id":"z_AlHELb7AcC2jGQ9Wjfs","data":[],"key":"GRw6WhwYdQ"}],"key":"QN0rOebJKo"},{"type":"block","kind":"notebook-code","data":{"placeholder":"./images/TBD.png"},"children":[{"type":"code","lang":"python","executable":true,"value":"# alt.data_transformers.enable(\"vegafusion\")\n\ndisplay(HTML(\"\"\"\n\u003cstyle\u003e\n  span.vega-bind-name {\n    color: #555;\n    margin: 0 10px 0 60px;\n    font-size: 20px;\n  }\n  .vega-bind label select {\n    color: #555;\n    font-size: 18px;\n  }\n\u003c/style\u003e\n\"\"\"))\n\n# yield chart\nyield_scale = alt.Scale(\n    domain=[0.0, 3000],\n    clamp=True\n)\nyield_color_scale = alt.Scale(\n    domain=['soy', 'corn'], \n    range=[SOY_COLOR, CORN_COLOR])\nyield_yaxis = alt.Axis(title='Biomass Yield', titleFontSize=18, titleColor=TITLE_COLOR, titleFontWeight=TITLE_WEIGHT)\nyield_chart = alt.Chart(chart_data).encode(\n    x=alt.X('date:T', title=None),\n    y=alt.Y('biomass:Q', axis=yield_yaxis, scale=yield_scale),\n    color=alt.Color('crop_type:N', scale=yield_color_scale)\n).mark_area(\n    filled=True,\n    opacity=YIELD_OPACITY,\n    interpolate='step-before')\n\n# interactive spectral index chart\nsi_yaxis = alt.Axis(title='Spectral Index', titleFontSize=18, titleColor=TITLE_COLOR, titleFontWeight=TITLE_WEIGHT)\nsi_dropdown = alt.binding_select(\n    options=INDICES,\n    labels=[n.upper() for n in INDICES],\n    name='Spectral Index: '.upper()\n)\nycol_param = alt.param(\n    value=DEFAULT_INDEX,\n    bind=si_dropdown\n)\nsi_chart = alt.Chart(chart_data).encode(\n    x=alt.X('date:T', title=None),\n    y=alt.Y('y:Q', axis=si_yaxis)\n).properties(\n    width=GRAPH_WIDTH,\n    height=HEIGHT\n).transform_calculate(\n    y=f'datum[{ycol_param.name}]'\n).add_params(\n    ycol_param\n).mark_area(\n    fill=SI_COLOR,\n    fillOpacity=SI_OPACITY\n)\n\n# display\ntitle = alt.Title(\n    TITLE,\n    color=TITLE_COLOR,\n    fontSize=TITLE_SIZE,\n    fontWeight=TITLE_WEIGHT,\n    subtitle=SUBTITLE,\n    subtitleColor=SUBTITLE_COLOR,\n    subtitleFontSize=SUBTITLE_SIZE)\n\nchart = alt.layer(yield_chart, si_chart).resolve_scale(y='independent')\nchart = chart.properties(\n    title=title).configure_legend(\n    title=None,\n    labelFontSize=18,  \n    labelColor=SUBTITLE_COLOR \n).interactive()\nchart ","identifier":"nb.indices_vs_yield-code","enumerator":"1","html_id":"nb-indices-vs-yield-code","key":"HekfqeHr3c"},{"type":"output","id":"c3qPo_0dQGlcoxdBpfE7I","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\n\u003cstyle\u003e\n  span.vega-bind-name {\n    color: #555;\n    margin: 0 10px 0 60px;\n    font-size: 20px;\n  }\n  .vega-bind label select {\n    color: #555;\n    font-size: 18px;\n  }\n\u003c/style\u003e\n","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"8675ffcc4bc1ba9bcdc0d1e6ff86a9a0","path":"/build/8675ffcc4bc1ba9bcdc0d1e6ff86a9a0.html"},"text/plain":{"content":"alt.LayerChart(...)","content_type":"text/plain"}}}],"identifier":"nb.indices_vs_yield-output","html_id":"nb-indices-vs-yield-output","children":[{"type":"image","placeholder":true,"url":"/myst_assets_folder./images/TBD.png","key":"DbxwW5scoH"}],"key":"WnPlkqpiCv"}],"identifier":"nb.indices_vs_yield","label":"nb.indices_vs_yield","html_id":"nb-indices-vs-yield","key":"cRumik1CiN"}],"key":"lYaq46m4QE"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Scripts","url":"/scripts","group":"Spectral Trend Database"}}},"domain":"http://localhost:3001"},"project":{"title":"Spectral Trend Database","subtitle":"a historcal database spectral indices","authors":[{"nameParsed":{"literal":"Brookie Guzder-Williams","given":"Brookie","family":"Guzder-Williams"},"name":"Brookie Guzder-Williams","orcid":"0000-0001-6855-8260","corresponding":true,"email":"bguzder-williams@berkeley.edu","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Maya Weltman-Fahs","given":"Maya","family":"Weltman-Fahs"},"name":"Maya Weltman-Fahs","affiliations":["dse","ucb"],"id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/SchmidtDSE/map_something","affiliations":[{"id":"dse","name":"The Eric and Wendy Schmidt Center for Data Science \u0026 Environment"},{"id":"ucb","name":"University of California, Berkeley"}],"toc":[{"file":"myst/main.md"},{"file":"myst/sections/intro.md"},{"file":"myst/sections/data.md"},{"file":"myst/sections/scripts.md"},{"file":"nb/spectral_trends.ipynb"}],"exports":[],"bibliography":[],"index":"main","pages":[{"slug":"intro","title":"Description","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"data","title":"Sample Selection","description":"","date":"","thumbnail":"/build/cornsoy-reduction-ddfb3a725f5809f1fa89d64c75aa4fac.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"scripts","title":"Scripts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"spectral-trends","title":"Biomass Yield and Spectral Trends","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-A92797E9.js";
import * as route0 from "/build/root-HROFNPGU.js";
import * as route1 from "/build/routes/$-WNZNXUO2.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-UNPC4GT3.js");</script></body></html>